<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Anime Template">
    <meta name="keywords" content="Anime, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Anims | Anime</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="css/plyr.css" type="text/css">
    <link rel="stylesheet" href="css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="css/style.css" type="text/css">
</head>

<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

    <!-- Header Section Begin -->
    <header class="header">
        <div class="container">
            <div class="row">
                <div class="col-lg-2">
                    <div class="header__logo">
                        <a href="./index.html">
                            <img src="img/logo.png" alt="">
                        </a>
                    </div>
                </div>
                <div class="col-lg-8">
                    <div class="header__nav">
                        <nav class="header__menu mobile-menu">
                            <ul>
                                <li><a href="./index.html">Página Inicial</a></li>
                                <li class="active"><a href="./categories.html">Animes</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
                <div class="col-lg-2">
                    <div class="header__right">
                        <div class="dropdown">
                            <button class="dropbtn"><span class="icon_profile"></span></button>
                            <div class="dropdown-content">
                                <a class="login" href="login.html">Entrar</a>
                                <a href="signup.html">Cadastrar</a>
                                <a onclick="logout(event)" id="logout-link" style="display: none;">Logout</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="mobile-menu-wrap"></div>
        </div>
    </header>
    <!-- Header End -->

    <!-- Breadcrumb Begin -->
    <div class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__links">
                        <a href="./index.html"><i class="fa fa-home"></i>Início</a>
                        <a href="./categories.html">Categorias</a>
                        <span>Ação</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Breadcrumb End -->

    <!-- Anime Section Begin -->
    <section class="anime-details spad">
        <div class="container">
            <div class="anime__details__content">
                <div class="row">
                    <div class="col-lg-3">
                        <div class="anime__details__pic set-bg" data-setbg="">
                            <div class="comment"><i class="fa fa-comments"></i> 11</div>
                            <div class="view"><i class="fa fa-star nota"></i></div>
                        </div>
                    </div>
                    <div class="col-lg-9">
                        <div class="anime__details__text">
                            <div class="anime__details__title">
                                <h3 class="titulo"></h3>
                                <span class="title2"></span>
                            </div>
                            <p class="sinopse"></p>
                            <div class="anime__details__widget">
                                <div class="row">
                                    <div class="col-lg-6 col-md-6">
                                        <ul>
                                            <li class="tipo"></li>
                                            <li class="estudio"></li>
                                            <li class="lancamento"></li>
                                            <li class="status"></li>
                                            <li class="genres"></li>
                                        </ul>
                                    </div>
                                    <div class="col-lg-6 col-md-6">
                                        <ul>
                                            <li class="score"></li>
                                            <li class="resenhas"><span>Resenhas:</span> 6</li>
                                            <li class="ep"></li>
                                            <li class="duracao"></li>
                                            <li class="views"></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="anime__details__btn">
                                <a href="" class="watch-btn"><span>Assista Agora</span> <i
                                        class="fa fa-angle-right"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12 col-md-12">
                    <div class="anime__details__review">
                        <div class="section-title">
                            <h5>Reviews</h5>
                        </div>
                        <div class="anime__review__item">
                            <div class="anime__review__item__pic">
                                <img src="img/anime/review-1.jpg" alt="">
                            </div>
                            <div class="anime__review__item__text">
                                <h6>karinaamaral - <span>29 julho 2022</span></h6>
                                <p>Um dos animes mais subestimados!!
                                    Vou começar pelo único ponto negativo do anime: A animação não é muito boa.
                                    No entanto, você logo acostuma. Agora dito isso, vou falar porque vale a pena
                                    assistir
                                    a essa obra.</p>
                            </div>
                        </div>
                    </div>
                    <div class="anime__details__form">
                        <div class="section-title">
                            <h5>Deixe seu comentário!</h5>
                        </div>
                        <form onsubmit="postComment(event)">
                            <div>
                                <input id="comment" placeholder="Comente" required></input>
                            </div>
                            <button type="submit" class="site-btn">Review</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Anime Section End -->

    <!-- Footer Section Begin -->
    <footer class="footer">
        <div class="page-up">
            <a href="#" id="scrollToTopButton"><span class="arrow_carrot-up"></span></a>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-lg-3">
                    <div class="footer__logo">
                        <a href="./index.html"><img src="img/logo.png" alt=""></a>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="footer__nav">
                        <ul>
                            <li class="active"><a href="./index.html">Página Inicial</a></li>
                            <li><a href="./categories.html">Animes</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer Section End -->

    <!-- Js Plugins -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/player.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/mixitup.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>

    <script>
        // IDs dos animes que serão buscados na API Jikan
        var url = window.location.href;

        // Criar um objeto URLSearchParams com a query string da URL
        var searchParams = new URLSearchParams(new URL(url).search);

        // Obter o valor do parâmetro "id"
        var id = searchParams.get('id');

        var animeIds2 = [id]; // Exemplo de IDs de animes
        var apiUrl = 'https://api.jikan.moe/v4/anime/';

        // Função para buscar dados de um anime específico pelo ID
        function fetchAnimeData(animeId) {
            return new Promise(function (resolve, reject) {
                var xhr = new XMLHttpRequest();
                xhr.open('GET', apiUrl + animeId);
                xhr.responseType = 'json';
                xhr.onload = function () {
                    if (xhr.status === 200) {
                        resolve(xhr.response.data);
                    } else {
                        reject(Error('Erro ao carregar dados do anime'));
                    }
                };
                xhr.onerror = function () {
                    reject(Error('Erro de rede ao tentar carregar dados do anime'));
                };
                xhr.send();
            });
        }

        // Promessas para buscar os dados de todos os animes
        var requests = animeIds2.map(function (animeId) {
            return fetchAnimeData(animeId);
        });

        // Executar todas as promessas
        Promise.all(requests).then(function (animes) {
            // Processar os resultados
            animes.forEach(function (anime, index) {
                // Selecionando o elemento HTML correspondente ao anime
                var animeItem = document.querySelectorAll('.anime__details__content')[index];

                // Preenchendo os elementos com os dados do anime
                var animePic = animeItem.querySelector('.anime__details__pic');
                animePic.style.backgroundImage = 'url(' + anime.images.webp.large_image_url + ')';

                var animeEps = animeItem.querySelector('.ep');
                animeEps.innerHTML = anime.episodes > 0 ? `<span>Episodios:</span> ${anime.episodes}` : `<span>Episodios:</span> ?`

                var animeTitle = animeItem.querySelector('.titulo')
                animeTitle.textContent = anime.title

                var animeTitlejap = animeItem.querySelector('.title2')
                animeTitlejap.textContent = anime.title_english

                var animeSinopsis = animeItem.querySelector('.sinopse')
                animeSinopsis.textContent = anime.synopsis

                var animeType = animeItem.querySelector('.tipo')
                animeType.innerHTML = `<span>Tipo:</span> ${anime.type}`

                var animeStudio = animeItem.querySelector('.estudio')
                animeStudio.innerHTML = `<span>Estúdio:</span> ${anime.studios[0].name}`

                var animeLaunch = animeItem.querySelector('.lancamento')
                animeLaunch.innerHTML = `<span>Lançamento:</span> ${anime.aired.string}`

                var animeStatus = animeItem.querySelector('.status')
                animeStatus.innerHTML = `<span>Status:</span> ${anime.status}`

                var animeGenre = animeItem.querySelector('.genres')
                var genresString = `<span>Gêneros:</span>`;
                anime.genres.forEach(function (genre, idx) {
                    genresString += genre.name;
                    if (idx < anime.genres.length - 1) {
                        genresString += ', '; // Adiciona vírgula entre os gêneros, exceto no último
                    }
                });
                animeGenre.innerHTML = genresString;

                var animeScore = animeItem.querySelector('.score')
                animeScore.innerHTML = `<span>Notas:</span> ${anime.score + ' / ' + anime.scored_by}`

                var animeDuration = animeItem.querySelector('.duracao')
                animeDuration.innerHTML = `<span>Duração:</span> ${anime.duration}`

                var animeViews = animeItem.querySelector('.views')
                animeViews.innerHTML = `<span>Membros:</span> ${anime.members}`

                var animeWatch = animeItem.querySelector('.watch-btn')
                animeWatch.setAttribute('href', anime.trailer.url)

                var animeScore1 = animeItem.querySelector('.nota')
                animeScore1.innerHTML = " Rank: " + anime.rank

                var animeItem2 = document.querySelectorAll('.breadcrumb-option')[index]

                var animeGenre2 = animeItem2.querySelector('.breadcrumb__links')
                animeGenre2.innerHTML = `<a href="./index.html"><i class="fa fa-home"></i>Início</a>
                        <a href="./categories.html">Categorias</a>
                        <span>${anime.genres[0].name}<span>`

                console.log(animes)
            });

        }).catch(function (error) {
            console.error('Erro ao carregar dados dos animes:', error);
        });
    </script>

    <script>    
        function checkLogin() {
                const userId = sessionStorage.getItem('UserId');
                const loginLink = document.querySelector('entrar');
                const signupLink = document.querySelector('signup');
                const logoutLink = document.getElementById('logout-link');

                if (userId !== null || 0) {
                    if (loginLink) {
                        loginLink.style.display = 'none';
                    }
                    if (signupLink) {
                        signupLink.style.display = 'none';
                    }
                    if (logoutLink) {
                        logoutLink.style.display = 'block';
                    }
                } else {
                    if (loginLink) loginLink.style.display = 'block';
                    if (signupLink) signupLink.style.display = 'block';
                    if (logoutLink) logoutLink.style.display = 'none';
                }
            }

            document.addEventListener('DOMContentLoaded', checkLogin);

            function logout() {
                sessionStorage.removeItem('UserId');
                window.location.href = 'index.html';
            }

    </script>

    <script>
            async function postComment(event) {
            event.preventDefault(); // Previne o envio padrão do formulário

            var url = window.location.href;
            var searchParams = new URLSearchParams(new URL(url).search);
            var id = searchParams.get('id');

            const comment = document.getElementById('comment').value;
            const userId = sessionStorage.getItem('UserId');
            const anime = id; // Usa o ID obtido da URL

            const data = {
                content: comment,
                user: userId, // Certifique-se de que este é o nome correto do campo
                animeId: anime
            };

            if (userId !== null || 0) { // Verifica se userId não é nulo ou vazio
                try {
                    const response = await fetch('http://localhost:3001/comment', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();
                    alert('Comentário feito com sucesso!');
                    console.log(result);
                } catch (error) {
                    console.error('Erro:', error);
                    alert('Erro ao enviar o comentário');
                }
            } else {
                alert('Por favor faça login antes de comentar! :)');
            }
    }
    </script>

</body>
</html>